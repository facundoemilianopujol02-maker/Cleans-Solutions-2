<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Solutions - Administraci√≥n</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="franjaSuperior">
        <div class="logo">Clean Solutions</div>
        
        <button id="btnAbrirLogin" class="btn-main">üîë Admin</button>

        <div id="panelControlAdmin" class="admin-panel" style="display: none;">
            <button onclick="abrirModal('modalProducto')" class="btn-admin btn-add">‚ûï Agregar Producto</button>
            <button id="btnToggleDelete" onclick="toggleModoEliminar()" class="btn-admin btn-mode">üóëÔ∏è Modo Eliminar: OFF</button>
            <button onclick="cerrarSesion()" class="btn-admin btn-logout">üö™ Cerrar Sesi√≥n</button>
        </div>
    </div>

    <div class="container main-content">
        <div id="productosContainer" class="grid-productos">
            <p>Cargando cat√°logo...</p>
        </div>
    </div>

    <div id="modalLogin" class="modal">
        <div class="modal-content">
            <h3>Panel de Administraci√≥n</h3>
            <p>Introduce la clave para gestionar productos.</p>
            <input type="password" id="passInput" placeholder="Contrase√±a">
            <div class="modal-buttons">
                <button onclick="cerrarModal('modalLogin')" class="btn-cancel">Cancelar</button>
                <button onclick="verificarPassword()" class="btn-confirm">Entrar</button>
            </div>
            <p id="errorMsg" style="color:red; display:none; margin-top:10px;">‚ùå Contrase√±a incorrecta</p>
        </div>
    </div>

    <div id="modalProducto" class="modal">
        <div class="modal-content">
            <h3>Nuevo Producto</h3>
            <form id="formNuevoProducto">
                <input type="text" id="id_prod" placeholder="ID (Ej: COD-01)" required>
                <input type="text" id="nombre_prod" placeholder="Nombre del producto" required>
                <input type="number" id="precio_prod" placeholder="Precio ($)" required>
                <input type="url" id="img_prod" placeholder="URL de la imagen (Opcional)">
                <textarea id="desc_prod" placeholder="Breve descripci√≥n"></textarea>
                <div class="modal-buttons">
                    <button type="button" onclick="cerrarModal('modalProducto')" class="btn-cancel">Cancelar</button>
                    <button type="submit" class="btn-confirm">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // URL DE TU GOOGLE SCRIPT (YA ACTUALIZADA)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbweFnqUYyHxLkYvlECp6TG_zFo8XLf5V9-w4LW_80SS61krgXDyhBWzM6_gdtJy35eK/exec';
        let modoEliminar = false;

        // --- SISTEMA DE VISTA ---
        function actualizarInterfaz() {
            const esAdmin = localStorage.getItem('cleanAdmin') === 'true';
            document.getElementById('btnAbrirLogin').style.display = esAdmin ? 'none' : 'block';
            document.getElementById('panelControlAdmin').style.display = esAdmin ? 'flex' : 'none';
        }

        // --- GESTI√ìN DE MODALES ---
        function abrirModal(id) { document.getElementById(id).style.display = 'flex'; }
        function cerrarModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- LOGIN Y LOGOUT ---
        document.getElementById('btnAbrirLogin').onclick = () => abrirModal('modalLogin');

        function verificarPassword() {
            const pass = document.getElementById('passInput').value;
            if (pass === 'Ragnar2025') {
                localStorage.setItem('cleanAdmin', 'true');
                cerrarModal('modalLogin');
                actualizarInterfaz();
                renderizar();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        function cerrarSesion() {
            localStorage.removeItem('cleanAdmin');
            modoEliminar = false;
            document.body.classList.remove('delete-mode-active');
            actualizarInterfaz();
            renderizar();
        }

        // --- MODO ELIMINAR ---
        function toggleModoEliminar() {
            modoEliminar = !modoEliminar;
            const btn = document.getElementById('btnToggleDelete');
            document.body.classList.toggle('delete-mode-active', modoEliminar);
            btn.textContent = modoEliminar ? 'üóëÔ∏è Eliminar: ON' : 'üóëÔ∏è Eliminar: OFF';
            btn.className = modoEliminar ? 'btn-admin btn-mode-on' : 'btn-admin btn-mode';
        }

        // --- CARGAR PRODUCTOS ---
        function renderizar() {
            const s = document.createElement('script');
            s.src = `${SCRIPT_URL}?action=get&callback=callbackData`;
            document.body.appendChild(s);
        }

        window.callbackData = function(data) {
            const box = document.getElementById('productosContainer');
            box.innerHTML = '';
            const isAdmin = localStorage.getItem('cleanAdmin') === 'true';

            if (!data.productos || data.productos.length === 0) {
                box.innerHTML = '<p>No hay productos en el cat√°logo.</p>';
                return;
            }

            data.productos.forEach(p => {
                const card = document.createElement('div');
                card.className = 'producto-card';
                card.innerHTML = `
                    <div class="img-wrapper">
                        <img src="${p.imagen || 'https://via.placeholder.com/200'}" alt="${p.nombre}">
                    </div>
                    <div class="info">
                        <h4>${p.nombre}</h4>
                        <p class="precio">$${p.precio}</p>
                        <p class="desc">${p.descripcion || ''}</p>
                        ${isAdmin ? `<button onclick="borrar('${p.id}')" class="btn-borrar-card">Eliminar Producto</button>` : ''}
                    </div>
                `;
                box.appendChild(card);
            });
        }

        // --- ACCIONES (BORRAR Y AGREGAR) ---
        window.borrar = function(id) {
            if(!confirm('¬øSeguro que quieres eliminar este producto?')) return;
            const s = document.createElement('script');
            s.src = `${SCRIPT_URL}?action=delete&id=${id}&callback=finalizarAccion`;
            document.body.appendChild(s);
        }

        document.getElementById('formNuevoProducto').onsubmit = function(e) {
            e.preventDefault();
            const params = new URLSearchParams({
                action: 'add',
                id: document.getElementById('id_prod').value,
                nombre: document.getElementById('nombre_prod').value,
                precio: document.getElementById('precio_prod').value,
                imagen: document.getElementById('img_prod').value,
                descripcion: document.getElementById('desc_prod').value,
                callback: 'finalizarAccion'
            });
            const s = document.createElement('script');
            s.src = `${SCRIPT_URL}?${params.toString()}`;
            document.body.appendChild(s);
        }

        window.finalizarAccion = function(res) {
            alert(res.message || res.error);
            cerrarModal('modalProducto');
            document.getElementById('formNuevoProducto').reset();
            renderizar();
        }

        // INICIAR
        actualizarInterfaz();
        renderizar();
    </script>
</body>
</html>

