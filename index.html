<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Solutions - Cat√°logo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="franjaSuperior">
        <div class="logo">Clean Solutions</div>
        
        <button id="btnAdminLogin" class="btn-main">üîë Admin</button>

        <div id="panelAdmin" class="admin-controls" style="display: none;">
            <button onclick="abrirModal('modalProducto')" class="btn-admin btn-add">‚ûï Agregar</button>
            <button id="btnToggleDelete" onclick="toggleModoEliminar()" class="btn-admin btn-mode">üóëÔ∏è Eliminar: OFF</button>
            <button onclick="cerrarSesion()" class="btn-admin btn-logout">üö™ Salir</button>
        </div>
    </div>

    <div class="container">
        <div id="productosContainer" class="grid-productos">
            </div>
    </div>

    <div id="modalLogin" class="modal">
        <div class="modal-content">
            <h3>Acceso Restringido</h3>
            <input type="password" id="passInput" placeholder="Contrase√±a">
            <div class="modal-buttons">
                <button onclick="cerrarModal('modalLogin')">Cancelar</button>
                <button onclick="intentarLogin()" class="btn-add">Entrar</button>
            </div>
            <p id="errorLogin" style="color:red; display:none; margin-top:10px;">Clave incorrecta</p>
        </div>
    </div>

    <div id="modalProducto" class="modal">
        <div class="modal-content">
            <h3>Nuevo Producto</h3>
            <form id="formProducto">
                <input type="text" id="p_id" placeholder="ID √önico" required>
                <input type="text" id="p_nombre" placeholder="Nombre" required>
                <input type="number" id="p_precio" placeholder="Precio" required>
                <input type="url" id="p_img" placeholder="URL de imagen">
                <textarea id="p_desc" placeholder="Descripci√≥n"></textarea>
                <div class="modal-buttons">
                    <button type="button" onclick="cerrarModal('modalProducto')">Cerrar</button>
                    <button type="submit" class="btn-add">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'TU_URL_DE_APPS_SCRIPT_AQUI'; // <--- PEGA TU URL AQU√ç
        let modoEliminarActivo = false;

        // --- GESTI√ìN DE INTERFAZ ---
        function actualizarVistaAdmin() {
            const logueado = localStorage.getItem('adminOK') === 'true';
            document.getElementById('btnAdminLogin').style.display = logueado ? 'none' : 'block';
            document.getElementById('panelAdmin').style.display = logueado ? 'flex' : 'none';
        }

        function abrirModal(id) { document.getElementById(id).style.display = 'flex'; }
        function cerrarModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- LOGIN / LOGOUT ---
        document.getElementById('btnAdminLogin').onclick = () => abrirModal('modalLogin');

        function intentarLogin() {
            if(document.getElementById('passInput').value === 'Ragnar2025') {
                localStorage.setItem('adminOK', 'true');
                cerrarModal('modalLogin');
                actualizarVistaAdmin();
                renderizar();
            } else {
                document.getElementById('errorLogin').style.display = 'block';
            }
        }

        function cerrarSesion() {
            localStorage.removeItem('adminOK');
            modoEliminarActivo = false;
            document.body.classList.remove('delete-active');
            actualizarVistaAdmin();
            renderizar();
        }

        function toggleModoEliminar() {
            modoEliminarActivo = !modoEliminarActivo;
            const btn = document.getElementById('btnToggleDelete');
            document.body.classList.toggle('delete-active', modoEliminarActivo);
            btn.textContent = modoEliminarActivo ? 'üóëÔ∏è Eliminar: ON' : 'üóëÔ∏è Eliminar: OFF';
            btn.style.background = modoEliminarActivo ? '#e74c3c' : '#f39c12';
        }

        // --- CARGA Y RENDER ---
        function renderizar() {
            const s = document.createElement('script');
            s.src = `${SCRIPT_URL}?action=get&callback=pintar`;
            document.body.appendChild(s);
        }

        window.pintar = function(res) {
            const box = document.getElementById('productosContainer');
            box.innerHTML = '';
            const isAdmin = localStorage.getItem('adminOK') === 'true';

            res.productos.forEach(p => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <img src="${p.imagen || 'https://via.placeholder.com/150'}">
                    <div class="info">
                        <h4>${p.nombre}</h4>
                        <p class="price">$${p.precio}</p>
                        ${isAdmin ? `<button onclick="eliminar('${p.id}')" class="btn-card-del">Eliminar</button>` : ''}
                    </div>
                `;
                box.appendChild(div);
            });
        }

        // --- ACCIONES ---
        window.eliminar = function(id) {
            if(!confirm('¬øEliminar producto?')) return;
            const s = document.createElement('script');
            s.src = `${SCRIPT_URL}?action=delete&id=${id}&callback=refrescar`;
            document.body.appendChild(s);
        }

        document.getElementById('formProducto').onsubmit = function(e) {
            e.preventDefault();
            const p = new URLSearchParams({
                action: 'add',
                id: document.getElementById('p_id').value,
                nombre: document.getElementById('p_nombre').value,
                precio: document.getElementById('p_precio').value,
                imagen: document.getElementById('p_img').value,
                descripcion: document.getElementById('p_desc').value,
                callback: 'refrescar'
            });
            const s = document.createElement('script');
            s.src = `${SCRIPT_URL}?${p.toString()}`;
            document.body.appendChild(s);
        }

        window.refrescar = function(res) {
            alert(res.message || res.error);
            cerrarModal('modalProducto');
            renderizar();
        }

        actualizarVistaAdmin();
        renderizar();
    </script>
</body>
</html>
