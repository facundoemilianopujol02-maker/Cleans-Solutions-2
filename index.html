<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Solutions - Productos</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="franjaSuperior">
        <h1>Clean Solutions</h1>
        <button id="btnAdmin" class="admin-btn">ðŸ”‘ Admin</button>
    </div>

    <div class="container main-content">
        <div id="productosContainer" class="productos-grid">
            <p id="loadingMessage">Cargando productos...</p>
        </div>
    </div>

    <div id="modalProducto" class="modal">
        <div class="modal-content">
            <h3>Nuevo Producto</h3>
            <form id="productForm">
                <input type="text" id="id" placeholder="ID del producto" required>
                <input type="text" id="nombre" placeholder="Nombre" required>
                <input type="number" id="precio" placeholder="Precio" required>
                <input type="url" id="imagen" placeholder="URL de la imagen (ej: https://...)">
                <textarea id="descripcion" placeholder="DescripciÃ³n"></textarea>
                <div class="modal-buttons">
                    <button type="button" id="cancelarForm">Cancelar</button>
                    <button type="submit" id="btnGuardar">Guardar</button>
                </div>
            </form>
            <div id="message"></div>
        </div>
    </div>

    <div id="modalLogin" class="modal">
        <div class="modal-content">
            <h3>Acceso Admin</h3>
            <input type="password" id="inputPassword" placeholder="ContraseÃ±a">
            <button id="btnLogin">Entrar</button>
            <p id="loginError" style="color:red; display:none;">ContraseÃ±a incorrecta</p>
        </div>
    </div>
     <script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyjRjtL51Ym89aKA3xma6wmUODJchdJXiLRuOdTc7b9FKJ8lbeqGZE2aUXUYPxvqrsR/exec'; //
function checkAdminStatus() {
    if (localStorage.getItem('admin') === 'true') {
        document.body.classList.add('modo-admin');
        // Si tienes un botÃ³n de "Cerrar SesiÃ³n", podrÃ­as mostrarlo aquÃ­
    }
}

// 2. CARGAR PRODUCTOS
async function cargarProductos() {
    console.log("Cargando productos...");
    const script = document.createElement('script');
    script.src = `${SCRIPT_URL}?action=get&callback=callbackProductos`;
    document.body.appendChild(script);
}

window.callbackProductos = function(data) {
    const container = document.getElementById('productosContainer');
    container.innerHTML = '';
    
    const isAdmin = localStorage.getItem('admin') === 'true';

    if (data.productos && data.productos.length > 0) {
        data.productos.forEach(p => {
            const card = document.createElement('div');
            card.className = 'producto-card';
            const imgUrl = p.imagen || 'https://via.placeholder.com/250x200?text=Sin+Imagen';
            
            card.innerHTML = `
                <div class="producto-imagen-container">
                    <img src="${imgUrl}" class="producto-imagen">
                </div>
                <div class="producto-info">
                    <h4>${p.nombre || 'Sin nombre'}</h4>
                    <p class="precio">$${p.precio || '0'}</p>
                    <p>${p.descripcion || ''}</p>
                    <small>ID: ${p.id}</small>
                    ${isAdmin ? `<button onclick="eliminar('${p.id}')" class="btn-delete" style="background:#ff4444; color:white; border:none; padding:8px; width:100%; border-radius:5px; cursor:pointer; margin-top:10px;">Eliminar Producto</button>` : ''}
                </div>
            `;
            container.appendChild(card);
        });
    } else {
        container.innerHTML = '<p>No hay productos para mostrar.</p>';
    }
};

// 3. ELIMINAR PRODUCTO
window.eliminar = function(id) {
    if(!confirm('Â¿EstÃ¡s seguro de que quieres borrar este producto?')) return;
    
    const script = document.createElement('script');
    script.src = `${SCRIPT_URL}?action=delete&id=${id}&callback=afterDelete`;
    document.body.appendChild(script);
};

window.afterDelete = function(res) {
    alert(res.message || res.error);
    if(res.success) cargarProductos();
};

// 4. AGREGAR PRODUCTO (FORMULARIO)
document.getElementById('productForm').onsubmit = function(e) {
    e.preventDefault();
    const btn = document.getElementById('btnGuardar');
    btn.disabled = true;
    btn.textContent = 'Enviando...';

    const params = new URLSearchParams({
        action: 'add',
        id: document.getElementById('id').value,
        nombre: document.getElementById('nombre').value,
        precio: document.getElementById('precio').value,
        imagen: document.getElementById('imagen').value,
        descripcion: document.getElementById('descripcion').value,
        callback: 'afterAdd'
    });

    const script = document.createElement('script');
    script.src = `${SCRIPT_URL}?${params.toString()}`;
    document.body.appendChild(script);
};

window.afterAdd = function(res) {
    alert(res.message || res.error);
    if(res.success) {
        document.getElementById('modalProducto').style.display = 'none';
        document.getElementById('productForm').reset();
        cargarProductos();
    }
    document.getElementById('btnGuardar').disabled = false;
    document.getElementById('btnGuardar').textContent = 'Guardar';
};

// 5. MANEJO DE MODALES Y LOGIN
document.getElementById('btnAdmin').onclick = () => {
    if(localStorage.getItem('admin') === 'true') {
        document.getElementById('modalProducto').style.display = 'flex';
    } else {
        document.getElementById('modalLogin').style.display = 'flex';
    }
};

document.getElementById('btnLogin').onclick = () => {
    const pass = document.getElementById('inputPassword').value;
    if(pass === 'Ragnar2025') {
        localStorage.setItem('admin', 'true');
        alert('Â¡Bienvenido Admin!');
        location.reload(); // Recargamos para que aparezcan los botones de eliminar
    } else {
        document.getElementById('loginError').style.display = 'block';
    }
};

// Cerrar modales si se hace clic fuera
window.onclick = function(event) {
    if (event.target.className === 'modal') {
        event.target.style.display = "none";
    }
}

// Iniciar
checkAdminStatus();
cargarProductos();
          </script>
</body>
</html>


