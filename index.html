<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Solutions | Cat√°logo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="navbar">
        <div class="nav-container">
            <div class="brand">
                <img src="logo.png" alt="Logo" class="logo-img">
                <span class="brand-name">CLEAN SOLUTIONS</span>
            </div>
            
            <div class="search-container">
                <input type="text" id="inputBusqueda" placeholder="Buscar producto..." onkeyup="filtrarProductos()">
            </div>

            <div class="nav-actions">
                <button id="btnEntrarAdmin" class="btn-primary" onclick="abrirModal('modalDeLogin')">üîë Acceso</button>
                <div id="panelAdminGlobal" class="admin-group" style="display: none;">
                    <button onclick="prepararFormulario('add')" class="btn-action btn-add">‚ûï Agregar</button>
                    <button id="btnModoBorrar" onclick="toggleBorrado()" class="btn-action btn-del-mode">üóëÔ∏è Borrar: OFF</button>
                    <button onclick="salirAdmin()" class="btn-action btn-exit">üö™ Salir</button>
                </div>
            </div>
        </div>
    </header>

    <main class="content-wrapper">
        <div id="contenedorProductos" class="product-grid">
            <p class="loading">Cargando cat√°logo...</p>
        </div>
    </main>

    <script>
        const URL_GOOGLE = 'https://script.google.com/macros/s/AKfycby1pr5Jl3tuC_J8L8yLv8Xybj66DJRneZFx7qL3fYi7r7TPIwjLBMtzuVVuNJyZYKNZ/exec';
        let productosLocales = []; // Importante para la b√∫squeda

        window.onload = () => {
            actualizarBarras();
            dibujarCatalogo();
        };

        // FUNCI√ìN DE CARGA ORIGINAL
        function dibujarCatalogo() {
            const s = document.createElement('script');
            s.src = `${URL_GOOGLE}?action=get&callback=procesarGet`;
            document.body.appendChild(s);
        }

        // PROCESAR GET (Aqu√≠ guardamos en la variable local para que el filtro funcione)
        window.procesarGet = function(res) {
            productosLocales = res.productos; 
            renderizarCards(productosLocales);
        };

        // ESTA FUNCI√ìN ES LA QUE DIBUJA (Separada para poder re-usarla al buscar)
        function renderizarCards(lista) {
            const caja = document.getElementById('contenedorProductos');
            caja.innerHTML = '';
            const isAdmin = localStorage.getItem('sesionClean') === 'true';

            lista.forEach(p => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.onclick = () => verDetalle(p.id);
                card.innerHTML = `
                    <div class="item-img">
                        <img src="${p.imagen || 'https://via.placeholder.com/400'}" alt="">
                        ${isAdmin ? `<button onclick="event.stopPropagation(); ejecutarBorrar('${p.id}')" class="quick-del">‚úï</button>` : ''}
                    </div>
                    <div class="item-info">
                        <h4>${p.nombre}</h4>
                        <p class="item-price">$${p.precio}</p>
                        ${isAdmin ? `<button onclick="event.stopPropagation(); prepararFormulario('edit', '${p.id}')" class="edit-btn">‚úé Modificar</button>` : ''}
                    </div>
                `;
                caja.appendChild(card);
            });
        }

        // L√ìGICA DE B√öSQUEDA
        function filtrarProductos() {
            const busqueda = document.getElementById('inputBusqueda').value.toLowerCase();
            const filtrados = productosLocales.filter(p => 
                p.nombre.toLowerCase().includes(busqueda) || 
                (p.descripcion && p.descripcion.toLowerCase().includes(busqueda))
            );
            renderizarCards(filtrados);
        }

        // (El resto de tus funciones: abrirModal, verDetalle, validarAcceso, etc. se mantienen igual)
    </script>
</body>
</html>
