<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Solutions - Sistema de Productos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .logo {
            max-width: 200px;
            height: auto;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #3498db;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #ecf0f1;
            padding: 20px;
        }
        
        .product-info {
            padding: 20px;
        }
        
        .product-name {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .product-price {
            font-size: 1.5rem;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .product-category {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .btn-add {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            transition: background 0.3s;
        }
        
        .btn-add:hover {
            background: #27ae60;
        }
        
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .status-bar {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .api-status {
            color: #27ae60;
            font-weight: bold;
        }
        
        .api-status.error {
            color: #e74c3c;
        }
        
        .total-products {
            font-size: 1.1rem;
            color: #2c3e50;
        }
        
        .btn-reload {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="logoclean.png" alt="Clean Solutions Logo" class="logo" id="logo">
            <h1>Clean Solutions</h1>
            <p class="subtitle">Sistema de Gesti√≥n de Productos</p>
        </header>
        
        <div class="status-bar">
            <div>
                Estado API: <span class="api-status" id="apiStatus">Conectando...</span>
            </div>
            <div class="total-products" id="totalProducts">
                Productos cargados: 0
            </div>
            <button class="btn-reload" onclick="cargarProductos()">
                üîÑ Recargar
            </button>
        </div>
        
        <div class="error-message" id="errorMessage">
            Error cargando productos. Intenta recargar la p√°gina.
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Cargando productos desde la base de datos...</p>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <!-- Los productos se cargar√°n aqu√≠ -->
        </div>
        
        <footer>
            <p>Clean Solutions ¬© 2024 - Sistema de Productos v1.0</p>
            <p>Conectado a: <span id="apiUrl">URL API</span></p>
        </footer>
    </div>

    <script>
        // Configuraci√≥n
        const APPS_SCRIPT_ID = 'AKfycbxU7yUE7N0pEFYq8iI2uDxV-Zht5vTLej6Z1AMvOz7rK-BEtAILDwXQ-rzn_YdUmvJL';
        const API_URL = `https://script.google.com/macros/s/${APPS_SCRIPT_ID}/exec`;
        
        // Elementos DOM
        const loadingElement = document.getElementById('loading');
        const productsGrid = document.getElementById('productsGrid');
        const errorMessage = document.getElementById('errorMessage');
        const apiStatus = document.getElementById('apiStatus');
        const totalProducts = document.getElementById('totalProducts');
        const apiUrlElement = document.getElementById('apiUrl');
        
        // Mostrar URL de API
        apiUrlElement.textContent = API_URL;
        
        // Funci√≥n principal para cargar productos
        function cargarProductos() {
            // Mostrar carga
            loadingElement.style.display = 'block';
            productsGrid.innerHTML = '';
            errorMessage.style.display = 'none';
            apiStatus.textContent = 'Conectando...';
            apiStatus.className = 'api-status';
            
            // Generar nombre √∫nico para el callback
            const callbackName = 'jsonpCallback_' + Date.now();
            const jsonpUrl = `${API_URL}?callback=${callbackName}`;
            
            // Crear script para JSONP
            const script = document.createElement('script');
            script.src = jsonpUrl;
            
            // Definir la funci√≥n callback
            window[callbackName] = function(response) {
                // Limpiar funci√≥n despu√©s de usarla
                delete window[callbackName];
                
                // Ocultar loading
                loadingElement.style.display = 'none';
                
                if (response && response.success) {
                    // √âxito
                    apiStatus.textContent = 'Conectado ‚úì';
                    apiStatus.className = 'api-status';
                    
                    // Mostrar productos
                    mostrarProductos(response.productos);
                    
                    // Actualizar contador
                    totalProducts.textContent = `Productos cargados: ${response.productos.length}`;
                    
                    console.log('Productos cargados:', response.productos);
                } else {
                    // Error en la respuesta
                    mostrarError('Error en la respuesta del servidor');
                }
                
                // Eliminar script
                if (script.parentNode) {
                    document.head.removeChild(script);
                }
            };
            
            // Manejar errores del script
            script.onerror = function() {
                delete window[callbackName];
                mostrarError('Error de conexi√≥n con el servidor');
                loadingElement.style.display = 'none';
                apiStatus.textContent = 'Error de conexi√≥n ‚úó';
                apiStatus.className = 'api-status error';
                
                if (script.parentNode) {
                    document.head.removeChild(script);
                }
            };
            
            // Agregar script al DOM
            document.head.appendChild(script);
            
            // Timeout por si falla
            setTimeout(function() {
                if (window[callbackName]) {
                    delete window[callbackName];
                    mostrarError('Timeout: El servidor tard√≥ demasiado en responder');
                    loadingElement.style.display = 'none';
                    apiStatus.textContent = 'Timeout ‚úó';
                    apiStatus.className = 'api-status error';
                    
                    if (script.parentNode) {
                        document.head.removeChild(script);
                    }
                }
            }, 15000); // 15 segundos timeout
        }
        
        // Funci√≥n para mostrar productos
        function mostrarProductos(productos) {
            productsGrid.innerHTML = '';
            
            if (!productos || productos.length === 0) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <p style="font-size: 1.2rem; color: #7f8c8d;">
                            No hay productos disponibles.
                        </p>
                    </div>
                `;
                return;
            }
            
            productos.forEach(producto => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <img src="${producto.imagen || 'https://via.placeholder.com/400x200/ecf0f1/7f8c8d?text=Clean+Solutions'}" 
                         alt="${producto.nombre}" 
                         class="product-image">
                    <div class="product-info">
                        <div class="product-category">${producto.categoria || 'General'}</div>
                        <h3 class="product-name">${producto.nombre}</h3>
                        <div class="product-price">$${producto.precio.toLocaleString('es-AR')}</div>
                        ${producto.stock !== undefined ? 
                          `<p style="color: ${producto.stock > 0 ? '#27ae60' : '#e74c3c'}; margin-bottom: 15px;">
                            ${producto.stock > 0 ? '‚úì En stock' : '‚úó Sin stock'}
                           </p>` : ''}
                        <button class="btn-add" onclick="agregarAlCarrito(${producto.id})">
                            üõí Agregar al carrito
                        </button>
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
        }
        
        // Funci√≥n para mostrar errores
        function mostrarError(mensaje) {
            errorMessage.innerHTML = `
                <strong>Error:</strong> ${mensaje}<br>
                <small>URL: ${API_URL}</small>
                <p style="margin-top: 10px;">
                    <button onclick="cargarProductos()" style="background: white; color: #e74c3c; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                        Reintentar
                    </button>
                </p>
            `;
            errorMessage.style.display = 'block';
        }
        
        // Funci√≥n para agregar al carrito (ejemplo)
        function agregarAlCarrito(productoId) {
            alert(`Producto ${productoId} agregado al carrito (funci√≥n de ejemplo)`);
            // Aqu√≠ puedes implementar la l√≥gica del carrito
        }
        
        // Manejar error de imagen del logo
        document.getElementById('logo').onerror = function() {
            this.src = 'https://via.placeholder.com/200x100/3498db/ffffff?text=Clean+Solutions';
            this.alt = 'Logo Clean Solutions';
        };
        
        // Cargar productos al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('P√°gina cargada - Iniciando carga de productos...');
            cargarProductos();
        });
        
        // Tambi√©n recargar cada 5 minutos (opcional)
        setInterval(function() {
            console.log('Recargando productos autom√°ticamente...');
            cargarProductos();
        }, 300000); // 5 minutos
    </script>
</body>
</html>
